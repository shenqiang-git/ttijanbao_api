<?xml version="1.0" encoding="UTF-8"?>
<testcase id="errorChapterAndSectionList" desc="获取错题/收藏的章节列表">
    <backgrounds>
        <background id="background_errorChapterAndSectionList" desc="数据初始化">
            <sql database="mmc_bigdata">
                #系统练习SQL
                #初始化数据
                DELETE FROM testpapers WHERE id IN(20000007);
                DELETE FROM papers_questions WHERE id IN(321940,321941,321942,321943,321944);
                DELETE FROM paperparts WHERE id IN(261685,261686,261687,261688);
                DELETE FROM questions WHERE id IN(300230,300231,300232,300233,300235);
                DELETE FROM sections WHERE id IN(38000);
                DELETE FROM chapters WHERE id IN(14000);

                #插入章节
                INSERT INTO `mmc_bigdata`.`sections` (`id`, `section`, `chapterid`, `xuekeid`, `subjectid`, `categoryid`, `industryid`, `questiontotal`, `islock`, `yaoguo_id`, `wangxiao_id`)
                    VALUES ('38000', '接口测试-节', '14000', '357', '3', '1', '1', '0', '0', '0', '0');
                INSERT INTO `mmc_bigdata`.`chapters` (`id`, `chapter`, `categoryid`, `subjectid`, `xuekeid`, `sectiontotal`, `is_sale`, `is_lock`, `price`, `taskid`, `order_num`, `status`, `img`, `give_paper`, `is_real`, `islock`, `yaoguo_id`, `wangxiao_id`)
                    VALUES ('14000', '接口测试-章', '1', '3', '357', '3', '1', '1', '0.0', '0', NULL, '2', '', '0', '0', '0', '0', '0');

                #插入系统练习
                INSERT INTO `mmc_bigdata`.`testpapers` (`id`, `papername`, `papername_alias`, `papertypeid`, `papernum`, `subjectid`, `totalnum`, `createtime`, `founder`, `paperprice`, `status`, `is_lock`, `is_autoload`, `testsource`, `testtype`, `taskid`, `is_sale`, `pid`, `provinceid`, `covers`, `sendtime`, `examlen`, `give_paper`, `is_real`, `chapterid`, `sectionid`, `xuekeid`, `shenhestatus`, `notpassreason`, `testid`, `testAssemblyType`, `showCont`, `nowprice`, `expectTime`, `giftId`, `shenheshijian`, `realquestionnum`, `provinceids`, `cityid`, `industryid`, `countryid`, `export_starttime`, `export_endtime`, `islive`, `init_paperid`, `year`, `xmxks`)
                    VALUES ('20000007', '接口测试-章', '', '5', '4', '3', '0', '1571280920', '傅建文', '0', '2', '1', '1', '全部', '1', '0', '1', '-1', '0', '', '1571280962', '0', '0', '0', '14000', '0', '357', '0', '', '0', '0', '100', '0.0', '0', '0', NULL, '4', '0', '0', '1', '0', '2019-10-17 10:55:20', '2019-10-17 10:55:20', '1', '0', '2018', '');

                #插入试题试卷对应关系
                INSERT INTO `mmc_bigdata`.`papers_questions` (`id`, `question_id`, `paper_id`, `stem`, `score`, `missscore`, `parentid`, `analysis`, `answer`, `paperpartid`, `examtag`, `knowledge8_id`, `sectionid`, `chapterid`, `sort`, `testid`)
                    VALUES ('321944', '300235', '20000007', NULL, '0', '0', '0', '', '', '261688', '0', '0', '0', '0', '1', '0');
                INSERT INTO `mmc_bigdata`.`papers_questions` (`id`, `question_id`, `paper_id`, `stem`, `score`, `missscore`, `parentid`, `analysis`, `answer`, `paperpartid`, `examtag`, `knowledge8_id`, `sectionid`, `chapterid`, `sort`, `testid`)
                    VALUES ('321943', '300231', '20000007', NULL, '0', '0', '0', '', '', '261687', '0', '0', '0', '0', '1', '0');
                INSERT INTO `mmc_bigdata`.`papers_questions` (`id`, `question_id`, `paper_id`, `stem`, `score`, `missscore`, `parentid`, `analysis`, `answer`, `paperpartid`, `examtag`, `knowledge8_id`, `sectionid`, `chapterid`, `sort`, `testid`)
                    VALUES ('321942', '300233', '20000007', NULL, '0', '0', '300232', '', '', '261686', '0', '0', '0', '0', '1', '0');
                INSERT INTO `mmc_bigdata`.`papers_questions` (`id`, `question_id`, `paper_id`, `stem`, `score`, `missscore`, `parentid`, `analysis`, `answer`, `paperpartid`, `examtag`, `knowledge8_id`, `sectionid`, `chapterid`, `sort`, `testid`)
                    VALUES ('321941', '300232', '20000007', NULL, '0', '0', '0', '', '', '261686', '0', '0', '0', '0', '1', '0');
                INSERT INTO `mmc_bigdata`.`papers_questions` (`id`, `question_id`, `paper_id`, `stem`, `score`, `missscore`, `parentid`, `analysis`, `answer`, `paperpartid`, `examtag`, `knowledge8_id`, `sectionid`, `chapterid`, `sort`, `testid`)
                    VALUES ('321940', '300230', '20000007', NULL, '0', '0', '0', '', '', '261685', '0', '0', '0', '0', '1', '0');

                #插入试卷分部
                INSERT INTO `mmc_bigdata`.`paperparts` (`id`, `part`, `testpaperid`, `structure`)
                    VALUES ('261688', '判断题', '20000007', '{\"partTitle\":\"\\u5224\\u65ad\\u9898\",\"questiontypeid\":\"5\",\"settinum\":\"1\",\"fenzhi\":\"0\",\"missfenzhi\":\"0\"}');
                INSERT INTO `mmc_bigdata`.`paperparts` (`id`, `part`, `testpaperid`, `structure`)
                    VALUES ('261687', '多选题', '20000007', '{\"partTitle\":\"\\u591a\\u9009\\u9898\",\"questiontypeid\":\"4\",\"settinum\":\"1\",\"fenzhi\":\"0\",\"missfenzhi\":\"0\"}');
                INSERT INTO `mmc_bigdata`.`paperparts` (`id`, `part`, `testpaperid`, `structure`)
                    VALUES ('261686', '共用题干题', '20000007', '{\"partTitle\":\"\\u5171\\u7528\\u9898\\u5e72\\u9898\",\"questiontypeid\":\"2\",\"settinum\":\"1\",\"fenzhi\":\"0\",\"missfenzhi\":\"0\"}');
                INSERT INTO `mmc_bigdata`.`paperparts` (`id`, `part`, `testpaperid`, `structure`)
                    VALUES ('261685', '单选题', '20000007', '{\"partTitle\":\"\\u5355\\u9009\\u9898\",\"questiontypeid\":\"1\",\"settinum\":\"1\",\"fenzhi\":\"0\",\"missfenzhi\":\"0\"}');

                #插入试题
                INSERT INTO `mmc_bigdata`.`questions` (`id`, `stem`, `score`, `difficulty`, `parentid`, `subCount`, `analysis`, `answer`, `verified`, `createdUserId`, `updatedUserId`, `createdTime`, `updatedTime`, `public`, `knowledgeid`, `sectionid`, `chapterid`, `xuekeid`, `subjectid`, `qtypetag`, `questiontypeid`, `optionid`, `status`, `istrue`, `testid`, `importbatch`, `nian`, `attribute1`, `attribute2`, `attribute3`, `stem_knowledges`, `missexam`, `usetime`, `rightrate`, `errrate`, `iserror`, `type`, `industryid`, `similarHandle`, `playcount`, `audiourl`, `setOpen`, `stem_math`, `videoanalysis`, `init_paperid`, `init_questionid`, `sort`, `init_answerRequire`, `init_topic`, `mosterroranswer`, `bjyvideoid`, `bjytype`, `province`, `city`, `colleges`)
                    VALUES ('300235', '<p>接口测试-节-判断题题目</p>', '0.0', '', '0', '0', '<p>解析</p>', 'A', '0', '1', '1', '2019-10-17 10:26:05', '2019-10-17 10:30:02', '0', '0', '38000', '14000', '357', '3', '', '5', '299989', '1', '0', '9', '', '', '', '', '', '', NULL, '0', '0', '0', '0', '1', '1', '2', '1', '', '0', '<p>接口测试-节-判断题题目</p>', '', '0', '0', '1', NULL, NULL, '', '0', '0', '', '', '');
                INSERT INTO `mmc_bigdata`.`questions` (`id`, `stem`, `score`, `difficulty`, `parentid`, `subCount`, `analysis`, `answer`, `verified`, `createdUserId`, `updatedUserId`, `createdTime`, `updatedTime`, `public`, `knowledgeid`, `sectionid`, `chapterid`, `xuekeid`, `subjectid`, `qtypetag`, `questiontypeid`, `optionid`, `status`, `istrue`, `testid`, `importbatch`, `nian`, `attribute1`, `attribute2`, `attribute3`, `stem_knowledges`, `missexam`, `usetime`, `rightrate`, `errrate`, `iserror`, `type`, `industryid`, `similarHandle`, `playcount`, `audiourl`, `setOpen`, `stem_math`, `videoanalysis`, `init_paperid`, `init_questionid`, `sort`, `init_answerRequire`, `init_topic`, `mosterroranswer`, `bjyvideoid`, `bjytype`, `province`, `city`, `colleges`)
                    VALUES ('300233', '<p>接口测试-节-共用题干题题目-子题目一</p>', '0.0', '', '300232', '0', '<p>这里是解析内容</p>', 'A', '0', '1', '1', '2019-10-17 10:24:35', '2019-10-17 10:27:30', '0', '0', '38000', '14000', '357', '3', '', '1', '299987', '1', '0', '9', '', '', '', '', '', '', NULL, '0', '0', '0', '0', '1', '1', '1', '1', '', '0', '<p>接口测试-节-共用题干题题目-子题目一</p>', '', '0', '0', '1', NULL, NULL, '', '0', '0', '', '', '');
                INSERT INTO `mmc_bigdata`.`questions` (`id`, `stem`, `score`, `difficulty`, `parentid`, `subCount`, `analysis`, `answer`, `verified`, `createdUserId`, `updatedUserId`, `createdTime`, `updatedTime`, `public`, `knowledgeid`, `sectionid`, `chapterid`, `xuekeid`, `subjectid`, `qtypetag`, `questiontypeid`, `optionid`, `status`, `istrue`, `testid`, `importbatch`, `nian`, `attribute1`, `attribute2`, `attribute3`, `stem_knowledges`, `missexam`, `usetime`, `rightrate`, `errrate`, `iserror`, `type`, `industryid`, `similarHandle`, `playcount`, `audiourl`, `setOpen`, `stem_math`, `videoanalysis`, `init_paperid`, `init_questionid`, `sort`, `init_answerRequire`, `init_topic`, `mosterroranswer`, `bjyvideoid`, `bjytype`, `province`, `city`, `colleges`)
                    VALUES ('300232', '<p>接口测试-节-共用题干题题目</p>', '0.0', '', '0', '1', '', '', '0', '1', '1', '2019-10-17 10:24:35', '2019-10-17 10:30:02', '0', '0', '38000', '14000', '357', '3', '', '2', '0', '1', '0', '9', '', '', '', '', '', '0', NULL, '0', '0', '0', '0', '1', '1', '2', '1', '', '0', NULL, '', '0', '0', '1', NULL, NULL, '', '0', '2', '', '', '');
                INSERT INTO `mmc_bigdata`.`questions` (`id`, `stem`, `score`, `difficulty`, `parentid`, `subCount`, `analysis`, `answer`, `verified`, `createdUserId`, `updatedUserId`, `createdTime`, `updatedTime`, `public`, `knowledgeid`, `sectionid`, `chapterid`, `xuekeid`, `subjectid`, `qtypetag`, `questiontypeid`, `optionid`, `status`, `istrue`, `testid`, `importbatch`, `nian`, `attribute1`, `attribute2`, `attribute3`, `stem_knowledges`, `missexam`, `usetime`, `rightrate`, `errrate`, `iserror`, `type`, `industryid`, `similarHandle`, `playcount`, `audiourl`, `setOpen`, `stem_math`, `videoanalysis`, `init_paperid`, `init_questionid`, `sort`, `init_answerRequire`, `init_topic`, `mosterroranswer`, `bjyvideoid`, `bjytype`, `province`, `city`, `colleges`)
                    VALUES ('300231', '<p>接口测试-节-多选题题目</p>', '0.0', '', '0', '0', '', 'AB', '0', '1', '1', '2019-10-17 10:22:53', '2019-10-17 10:30:02', '0', '0', '38000', '14000', '357', '3', '', '4', '299986', '1', '0', '9', '', '', '', '', '', '', NULL, '0', '0', '0', '0', '1', '1', '2', '1', '', '0', '<p>接口测试-节-多选题题目</p>', '', '0', '0', '1', NULL, NULL, '', '0', '0', '', '', '');
                INSERT INTO `mmc_bigdata`.`questions` (`id`, `stem`, `score`, `difficulty`, `parentid`, `subCount`, `analysis`, `answer`, `verified`, `createdUserId`, `updatedUserId`, `createdTime`, `updatedTime`, `public`, `knowledgeid`, `sectionid`, `chapterid`, `xuekeid`, `subjectid`, `qtypetag`, `questiontypeid`, `optionid`, `status`, `istrue`, `testid`, `importbatch`, `nian`, `attribute1`, `attribute2`, `attribute3`, `stem_knowledges`, `missexam`, `usetime`, `rightrate`, `errrate`, `iserror`, `type`, `industryid`, `similarHandle`, `playcount`, `audiourl`, `setOpen`, `stem_math`, `videoanalysis`, `init_paperid`, `init_questionid`, `sort`, `init_answerRequire`, `init_topic`, `mosterroranswer`, `bjyvideoid`, `bjytype`, `province`, `city`, `colleges`)
                    VALUES ('300230', '<p>接口测试-节-单选题题目</p>', '0.0', '', '0', '0', '<p>这里是解析内容</p>', 'A', '0', '1', '1', '2019-10-17 10:21:41', '2019-10-17 10:30:02', '0', '0', '38000', '14000', '357', '3', '', '1', '299985', '1', '0', '9', '', '', '', '', '', '', NULL, '0', '0', '0', '0', '1', '1', '2', '1', '', '0', '<p>接口测试-节-单选题题目</p>', '', '0', '0', '1', NULL, NULL, '', '0', '0', '', '', '');

                #插入个人做错或者收藏的试题
                #删除错题/收藏题
                DELETE FROM testuserquestions WHERE userid IN(20008);
                #错题+收藏（单选题）
                INSERT INTO `mmc_bigdata`.`testuserquestions` (`id`, `userid`, `chapterid`, `sectionid`, `questionid`, `update_tm`, `create_tm`, `is_error`, `paperid`, `is_store`)
                    VALUES ('15788', '20008', '0', '0', '300230', '2019-10-18 09:13:15', '2019-10-18 09:13:12', '2', '0', '1');

                #错题+收藏（多选题）
                INSERT INTO `mmc_bigdata`.`testuserquestions` (`id`, `userid`, `chapterid`, `sectionid`, `questionid`, `update_tm`, `create_tm`, `is_error`, `paperid`, `is_store`)
                    VALUES ('15790', '20008', '0', '0', '300231', '0000-00-00 00:00:00', '2019-10-18 09:18:10', '2', '0', '2');
                INSERT INTO `mmc_bigdata`.`testuserquestions` (`id`, `userid`, `chapterid`, `sectionid`, `questionid`, `update_tm`, `create_tm`, `is_error`, `paperid`, `is_store`)
                    VALUES ('15789', '20008', '0', '0', '300231', '0000-00-00 00:00:00', '2019-10-18 09:18:09', '0', '20000007', '1');

            </sql>
        </background>
    </backgrounds>

    <afterSuit desc="测试后清除数据">
        <sql database="mmc_bigdata">
            DELETE FROM sections WHERE id IN(38000);
            DELETE FROM chapters WHERE id IN(14000);
            DELETE FROM testpapers WHERE id IN(20000007);
            DELETE FROM papers_questions WHERE id IN(321940,321941,321942,321943,321944);
            DELETE FROM paperparts WHERE id IN(261685,261686,261687,261688);
            DELETE FROM questions WHERE id IN(300230,300231,300232,300233,300235);
            DELETE FROM testuserquestions WHERE userid IN(20008);
        </sql>
    </afterSuit>

    <case id="errorChapterAndSectionList_001" desc="获取错题的章节列表" tag="normal">
        <print/>
        <set>
                <param subjectid="3"
                       type="1"
                       xuekeid="357"/>
        </set>
        <call service="errorChapterAndSectionList">
            <param name="http-headers">{"Authorization":"$Authorization"}</param>
            <param name="subjectid">${subjectid}</param>
            <param name="type">${type}</param>
            <param name="xuekeid">${xuekeid}</param>
        </call>
        <print />
        <assert>
            <status>200</status>
            <body>
                <![CDATA[
                {
                    "code": 200,
                    "data": [
                        {
                            "chapter": "接口测试-章",
                            "number": "2",
                            "ordername": "第18章",
                            "chapterid": "14000",
                            "SectionList": [
                                {
                                    "number": "2",
                                    "section": "接口测试-节",
                                    "id": "38000",
                                    "questionfinished": 0,
                                    "ordername": "第1节"
                                }
                            ]
                        }
                    ],
                    "message": "请求成功"
                }
                ]]>
            </body>
        </assert>
    </case>

    <case id="errorChapterAndSectionList_002" desc="获取收藏试题的章节列表" tag="normal">
        <print/>
        <set>
            <param subjectid="3"
                   type="2"
                   xuekeid="357"/>
        </set>
        <call service="errorChapterAndSectionList">
            <param name="http-headers">{"Authorization":"$Authorization"}</param>
            <param name="subjectid">${subjectid}</param>
            <param name="type">${type}</param>
            <param name="xuekeid">${xuekeid}</param>
        </call>
        <print />
        <assert>
            <status>200</status>
            <body>
                <![CDATA[
                {
                    "code": 200,
                    "data": [
                        {
                            "chapter": "接口测试-章",
                            "number": "2",
                            "ordername": "第18章",
                            "chapterid": "14000",
                            "SectionList": [
                                {
                                    "number": "2",
                                    "section": "接口测试-节",
                                    "id": "38000",
                                    "questionfinished": 0,
                                    "ordername": "第1节"
                                }
                            ]
                        }
                    ],
                    "message": "请求成功"
                }

                ]]>
            </body>
        </assert>
    </case>

</testcase>