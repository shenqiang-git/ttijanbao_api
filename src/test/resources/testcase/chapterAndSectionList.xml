<?xml version="1.0" encoding="UTF-8"?>
<testcase id="chapterAndSectionList" desc="获取章节练习的章节列表">
    <backgrounds>
        <background id="background_chapterAndSectionList" desc="数据初始化">
            <sql database="mmc_bigdata">
                #章节练习sql
                #初始化数据
                DELETE FROM chapters WHERE id IN(14000);
                DELETE FROM sections WHERE id IN(38000);
                DELETE FROM testpapers WHERE id IN(20000005,20000006);
                DELETE FROM papers_questions WHERE id IN(321935,321936,321937,321938,321939);
                DELETE FROM paperparts WHERE id IN(261681,261682,261683,261684);
                DELETE FROM questions WHERE id IN(300230,300231,300232,300233,300235);

                #插入章节
                INSERT INTO `mmc_bigdata`.`chapters` (`id`, `chapter`, `categoryid`, `subjectid`, `xuekeid`, `sectiontotal`, `is_sale`, `is_lock`, `price`, `taskid`, `order_num`, `status`, `img`, `give_paper`, `is_real`, `islock`, `yaoguo_id`, `wangxiao_id`)
                    VALUES ('14000', '接口测试-章', '1', '3', '357', '3', '1', '1', '0.0', '0', NULL, '2', '', '0', '0', '0', '0', '0');
                INSERT INTO `mmc_bigdata`.`sections` (`id`, `section`, `chapterid`, `xuekeid`, `subjectid`, `categoryid`, `industryid`, `questiontotal`, `islock`, `yaoguo_id`, `wangxiao_id`)
                    VALUES ('38000', '接口测试-节', '14000', '357', '3', '1', '1', '0', '0', '0', '0');

                #插入试卷
                INSERT INTO `mmc_bigdata`.`testpapers` (`id`, `papername`, `papername_alias`, `papertypeid`, `papernum`, `subjectid`, `totalnum`, `createtime`, `founder`, `paperprice`, `status`, `is_lock`, `is_autoload`, `testsource`, `testtype`, `taskid`, `is_sale`, `pid`, `provinceid`, `covers`, `sendtime`, `examlen`, `give_paper`, `is_real`, `chapterid`, `sectionid`, `xuekeid`, `shenhestatus`, `notpassreason`, `testid`, `testAssemblyType`, `showCont`, `nowprice`, `expectTime`, `giftId`, `shenheshijian`, `realquestionnum`, `provinceids`, `cityid`, `industryid`, `countryid`, `export_starttime`, `export_endtime`, `islive`, `init_paperid`, `year`, `xmxks`)
                    VALUES ('20000006', '接口测试-节', '', '6', '4', '3', '0', '1571279852', '傅建文', '0', '2', '1', '1', '全部', '1', '0', '1', '20000005', '0', '', '1571280146', '0', '0', '0', '14000', '38000', '357', '0', '', '0', '0', '100', '0.0', '0', '0', NULL, '4', '0', '0', '1', '0', '2019-10-17 10:37:32', '2019-10-17 10:37:32', '1', '0', '2018', '');
                INSERT INTO `mmc_bigdata`.`testpapers` (`id`, `papername`, `papername_alias`, `papertypeid`, `papernum`, `subjectid`, `totalnum`, `createtime`, `founder`, `paperprice`, `status`, `is_lock`, `is_autoload`, `testsource`, `testtype`, `taskid`, `is_sale`, `pid`, `provinceid`, `covers`, `sendtime`, `examlen`, `give_paper`, `is_real`, `chapterid`, `sectionid`, `xuekeid`, `shenhestatus`, `notpassreason`, `testid`, `testAssemblyType`, `showCont`, `nowprice`, `expectTime`, `giftId`, `shenheshijian`, `realquestionnum`, `provinceids`, `cityid`, `industryid`, `countryid`, `export_starttime`, `export_endtime`, `islive`, `init_paperid`, `year`, `xmxks`)
                    VALUES ('20000005', '接口测试-章', '', '6', '0', '3', '0', '1571279852', '傅建文', '0', '2', '1', '1', '', '1', '0', '1', '-1', '0', '', '1571280146', '0', '0', '0', '14000', '0', '357', '0', '', '0', '0', '100', '0.0', '0', '0', NULL, '0', '0', '0', '1', '0', '2019-10-17 10:37:32', '2019-10-17 10:37:32', '1', '0', '2018', '');

                #插入试卷和试题的对应关系
                INSERT INTO `mmc_bigdata`.`papers_questions` (`id`, `question_id`, `paper_id`, `stem`, `score`, `missscore`, `parentid`, `analysis`, `answer`, `paperpartid`, `examtag`, `knowledge8_id`, `sectionid`, `chapterid`, `sort`, `testid`)
                    VALUES ('321935', '300230', '20000006', NULL, '0', '0', '0', '', '', '261681', '0', '0', '0', '0', '1', '0');
                INSERT INTO `mmc_bigdata`.`papers_questions` (`id`, `question_id`, `paper_id`, `stem`, `score`, `missscore`, `parentid`, `analysis`, `answer`, `paperpartid`, `examtag`, `knowledge8_id`, `sectionid`, `chapterid`, `sort`, `testid`)
                    VALUES ('321936', '300232', '20000006', NULL, '0', '0', '0', '', '', '261682', '0', '0', '0', '0', '1', '0');
                INSERT INTO `mmc_bigdata`.`papers_questions` (`id`, `question_id`, `paper_id`, `stem`, `score`, `missscore`, `parentid`, `analysis`, `answer`, `paperpartid`, `examtag`, `knowledge8_id`, `sectionid`, `chapterid`, `sort`, `testid`)
                    VALUES ('321937', '300233', '20000006', NULL, '0', '0', '300232', '', '', '261682', '0', '0', '0', '0', '1', '0');
                INSERT INTO `mmc_bigdata`.`papers_questions` (`id`, `question_id`, `paper_id`, `stem`, `score`, `missscore`, `parentid`, `analysis`, `answer`, `paperpartid`, `examtag`, `knowledge8_id`, `sectionid`, `chapterid`, `sort`, `testid`)
                    VALUES ('321938', '300231', '20000006', NULL, '0', '0', '0', '', '', '261683', '0', '0', '0', '0', '1', '0');
                INSERT INTO `mmc_bigdata`.`papers_questions` (`id`, `question_id`, `paper_id`, `stem`, `score`, `missscore`, `parentid`, `analysis`, `answer`, `paperpartid`, `examtag`, `knowledge8_id`, `sectionid`, `chapterid`, `sort`, `testid`)
                    VALUES ('321939', '300235', '20000006', NULL, '0', '0', '0', '', '', '261684', '0', '0', '0', '0', '1', '0');

                #插入试卷部分内容
                INSERT INTO `mmc_bigdata`.`paperparts` (`id`, `part`, `testpaperid`, `structure`)
                    VALUES ('261684', '判断题', '20000006', '{\"partTitle\":\"\\u5224\\u65ad\\u9898\",\"questiontypeid\":5,\"settinum\":\"1\",\"fenzhi\":0,\"missfenzhi\":0,\"xuekeids\":[]}');
                INSERT INTO `mmc_bigdata`.`paperparts` (`id`, `part`, `testpaperid`, `structure`)
                    VALUES ('261683', '多选题', '20000006', '{\"partTitle\":\"\\u591a\\u9009\\u9898\",\"questiontypeid\":4,\"settinum\":\"1\",\"fenzhi\":0,\"missfenzhi\":0,\"xuekeids\":[]}');
                INSERT INTO `mmc_bigdata`.`paperparts` (`id`, `part`, `testpaperid`, `structure`)
                    VALUES ('261682', '共用题干题', '20000006', '{\"partTitle\":\"\\u5171\\u7528\\u9898\\u5e72\\u9898\",\"questiontypeid\":2,\"settinum\":\"1\",\"fenzhi\":0,\"missfenzhi\":0,\"xuekeids\":[]}');
                INSERT INTO `mmc_bigdata`.`paperparts` (`id`, `part`, `testpaperid`, `structure`)
                    VALUES ('261681', '单选题', '20000006', '{\"partTitle\":\"\\u5355\\u9009\\u9898\",\"questiontypeid\":1,\"settinum\":\"1\",\"fenzhi\":0,\"missfenzhi\":0,\"xuekeids\":[]}');

                #插入试题
                INSERT INTO `mmc_bigdata`.`questions` (`id`, `stem`, `score`, `difficulty`, `parentid`, `subCount`, `analysis`, `answer`, `verified`, `createdUserId`, `updatedUserId`, `createdTime`, `updatedTime`, `public`, `knowledgeid`, `sectionid`, `chapterid`, `xuekeid`, `subjectid`, `qtypetag`, `questiontypeid`, `optionid`, `status`, `istrue`, `testid`, `importbatch`, `nian`, `attribute1`, `attribute2`, `attribute3`, `stem_knowledges`, `missexam`, `usetime`, `rightrate`, `errrate`, `iserror`, `type`, `industryid`, `similarHandle`, `playcount`, `audiourl`, `setOpen`, `stem_math`, `videoanalysis`, `init_paperid`, `init_questionid`, `sort`, `init_answerRequire`, `init_topic`, `mosterroranswer`, `bjyvideoid`, `bjytype`, `province`, `city`, `colleges`)
                    VALUES ('300235', '<![CDATA[<p>接口测试-节-判断题题目</p>]]>', '0.0', '', '0', '0', '<![CDATA[<p>解析</p>]]>', 'A', '0', '1', '1', '2019-10-17 10:26:05', '2019-10-17 10:30:02', '0', '0', '38000', '14000', '357', '3', '', '5', '299989', '1', '0', '9', '', '', '', '', '', '', NULL, '0', '0', '0', '0', '1', '1', '2', '1', '', '0', '<![CDATA[<p>接口测试-节-判断题题目</p>]]>', '', '0', '0', '1', NULL, NULL, '', '0', '0', '', '', '');
                INSERT INTO `mmc_bigdata`.`questions` (`id`, `stem`, `score`, `difficulty`, `parentid`, `subCount`, `analysis`, `answer`, `verified`, `createdUserId`, `updatedUserId`, `createdTime`, `updatedTime`, `public`, `knowledgeid`, `sectionid`, `chapterid`, `xuekeid`, `subjectid`, `qtypetag`, `questiontypeid`, `optionid`, `status`, `istrue`, `testid`, `importbatch`, `nian`, `attribute1`, `attribute2`, `attribute3`, `stem_knowledges`, `missexam`, `usetime`, `rightrate`, `errrate`, `iserror`, `type`, `industryid`, `similarHandle`, `playcount`, `audiourl`, `setOpen`, `stem_math`, `videoanalysis`, `init_paperid`, `init_questionid`, `sort`, `init_answerRequire`, `init_topic`, `mosterroranswer`, `bjyvideoid`, `bjytype`, `province`, `city`, `colleges`)
                    VALUES ('300233', '<![CDATA[<p>接口测试-节-共用题干题题目-子题目一</p>]]>', '0.0', '', '300232', '0', '<![CDATA[<p>这里是解析内容</p>]]>', 'A', '0', '1', '1', '2019-10-17 10:24:35', '2019-10-17 10:27:30', '0', '0', '38000', '14000', '357', '3', '', '1', '299987', '1', '0', '9', '', '', '', '', '', '', NULL, '0', '0', '0', '0', '1', '1', '1', '1', '', '0', '<![CDATA[<p>接口测试-节-共用题干题题目-子题目一</p>]]>', '', '0', '0', '1', NULL, NULL, '', '0', '0', '', '', '');
                INSERT INTO `mmc_bigdata`.`questions` (`id`, `stem`, `score`, `difficulty`, `parentid`, `subCount`, `analysis`, `answer`, `verified`, `createdUserId`, `updatedUserId`, `createdTime`, `updatedTime`, `public`, `knowledgeid`, `sectionid`, `chapterid`, `xuekeid`, `subjectid`, `qtypetag`, `questiontypeid`, `optionid`, `status`, `istrue`, `testid`, `importbatch`, `nian`, `attribute1`, `attribute2`, `attribute3`, `stem_knowledges`, `missexam`, `usetime`, `rightrate`, `errrate`, `iserror`, `type`, `industryid`, `similarHandle`, `playcount`, `audiourl`, `setOpen`, `stem_math`, `videoanalysis`, `init_paperid`, `init_questionid`, `sort`, `init_answerRequire`, `init_topic`, `mosterroranswer`, `bjyvideoid`, `bjytype`, `province`, `city`, `colleges`)
                    VALUES ('300232', '<![CDATA[<p>接口测试-节-共用题干题题目</p>]]>', '0.0', '', '0', '1', '', '', '0', '1', '1', '2019-10-17 10:24:35', '2019-10-17 10:30:02', '0', '0', '38000', '14000', '357', '3', '', '2', '0', '1', '0', '9', '', '', '', '', '', '0', NULL, '0', '0', '0', '0', '1', '1', '2', '1', '', '0', NULL, '', '0', '0', '1', NULL, NULL, '', '0', '2', '', '', '');
                INSERT INTO `mmc_bigdata`.`questions` (`id`, `stem`, `score`, `difficulty`, `parentid`, `subCount`, `analysis`, `answer`, `verified`, `createdUserId`, `updatedUserId`, `createdTime`, `updatedTime`, `public`, `knowledgeid`, `sectionid`, `chapterid`, `xuekeid`, `subjectid`, `qtypetag`, `questiontypeid`, `optionid`, `status`, `istrue`, `testid`, `importbatch`, `nian`, `attribute1`, `attribute2`, `attribute3`, `stem_knowledges`, `missexam`, `usetime`, `rightrate`, `errrate`, `iserror`, `type`, `industryid`, `similarHandle`, `playcount`, `audiourl`, `setOpen`, `stem_math`, `videoanalysis`, `init_paperid`, `init_questionid`, `sort`, `init_answerRequire`, `init_topic`, `mosterroranswer`, `bjyvideoid`, `bjytype`, `province`, `city`, `colleges`)
                    VALUES ('300231', '<![CDATA[<p>接口测试-节-多选题题目</p>]]>', '0.0', '', '0', '0', '', 'AB', '0', '1', '1', '2019-10-17 10:22:53', '2019-10-17 10:30:02', '0', '0', '38000', '14000', '357', '3', '', '4', '299986', '1', '0', '9', '', '', '', '', '', '', NULL, '0', '0', '0', '0', '1', '1', '2', '1', '', '0', '<![CDATA[<p>接口测试-节-多选题题目</p>]]>', '', '0', '0', '1', NULL, NULL, '', '0', '0', '', '', '');
                INSERT INTO `mmc_bigdata`.`questions` (`id`, `stem`, `score`, `difficulty`, `parentid`, `subCount`, `analysis`, `answer`, `verified`, `createdUserId`, `updatedUserId`, `createdTime`, `updatedTime`, `public`, `knowledgeid`, `sectionid`, `chapterid`, `xuekeid`, `subjectid`, `qtypetag`, `questiontypeid`, `optionid`, `status`, `istrue`, `testid`, `importbatch`, `nian`, `attribute1`, `attribute2`, `attribute3`, `stem_knowledges`, `missexam`, `usetime`, `rightrate`, `errrate`, `iserror`, `type`, `industryid`, `similarHandle`, `playcount`, `audiourl`, `setOpen`, `stem_math`, `videoanalysis`, `init_paperid`, `init_questionid`, `sort`, `init_answerRequire`, `init_topic`, `mosterroranswer`, `bjyvideoid`, `bjytype`, `province`, `city`, `colleges`)
                    VALUES ('300230', '<![CDATA[<p>接口测试-节-单选题题目</p>]]>', '0.0', '', '0', '0', '<![CDATA[<p>这里是解析内容</p>]]>', 'A', '0', '1', '1', '2019-10-17 10:21:41', '2019-10-17 10:30:02', '0', '0', '38000', '14000', '357', '3', '', '1', '299985', '1', '0', '9', '', '', '', '', '', '', NULL, '0', '0', '0', '0', '1', '1', '2', '1', '', '0', '<![CDATA[<p>接口测试-节-单选题题目</p>]]>', '', '0', '0', '1', NULL, NULL, '', '0', '0', '', '', '');
            </sql>
        </background>
    </backgrounds>

    <afterSuit desc="测试后清除数据">
        <sql database="mmc_bigdata">
            DELETE FROM chapters WHERE id IN(14000);
            DELETE FROM sections WHERE id IN(38000);
            DELETE FROM testpapers WHERE id IN(20000005,20000006);
            DELETE FROM papers_questions WHERE id IN(321935,321936,321937,321938,321939);
            DELETE FROM paperparts WHERE id IN(261681,261682,261683,261684);
            DELETE FROM questions WHERE id IN(300230,300231,300232,300233,300235);
        </sql>
    </afterSuit>

    <case id="chapterAndSectionList_001" desc="新增的章节练习列表可展示" tag="normal">
        <print/>
        <call service="clearcache_chapterandsection">
        </call>
        <set>
                <param subjectid="3"
                       xuekeid="357"/>
        </set>
        <call service="chapterAndSection">
            <param name="http-headers">{"Authorization":"$Authorization"}</param>
            <param name="subjectid">${subjectid}</param>
            <param name="xuekeid">${xuekeid}</param>
        </call>
        <print />
        <assert>
            <status>200</status>
            <body>
                <![CDATA[
                {
                    "code": 200,
                    "data": {
                        "list":hasItem ("
                            {
                                \"id\":14000,
                                \"chapter\":\"接口测试-章\",
                                \"sectiontotal\":\"3\",
                                \"is_sale\":\"1\",
                                \"price\":\"0.0\",
                                \"is_lock\":\"1\",
                                \"taskid\":\"0\",
                                \"order_name\":notnull,
                                \"section\":[
                                    {
                                        \"id\":20000006,
                                        \"section\":\"接口测试-节\",
                                        \"questiontotal\":\"4\",
                                        \"order_name\":\"第1节\",
                                        \"questionfinished\":\"4\"
                                    }
                                ]
                            }
                        "),
                        "share": {
                            "img": "http://huatu-yl-mmc.oss-cn-beijing.aliyuncs.com/appicon/question_share.png",
                            "title": "机考刷题  必过神器",
                            "link": "http://mmc-test.huatu.com/share/testquestions?userid=20008",
                            "content": "卫人机考最全的医疗行业模考app给您最真实的人机对话模考场景"
                        }
                    },
                    "message": "请求成功"
                }
                ]]>
            </body>
        </assert>
    </case>

</testcase>